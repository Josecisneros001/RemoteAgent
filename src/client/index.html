<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Remote Agent</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
  <div id="app">
    <!-- Mobile Header (visible on mobile only) -->
    <header class="mobile-header">
      <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
      <h1>ðŸ¤– Remote Agent</h1>
      <div class="connection-status" id="connectionStatus">
        <span class="status-dot"></span>
      </div>
    </header>

    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h1>ðŸ¤– Remote Agent</h1>
          <div class="connection-status desktop-only" id="connectionStatusDesktop">
            <span class="status-dot"></span>
            <span class="status-text">Connecting...</span>
          </div>
        </div>

        <!-- New Session Button -->
        <button class="new-session-btn" id="newSessionBtn">
          <span class="icon">âž•</span>
          <span>New Session</span>
        </button>

        <!-- Session List -->
        <div class="sessions-container">
          <div class="sessions-header">
            <span>Sessions</span>
            <select id="workspaceFilter" class="workspace-filter">
              <option value="">All Workspaces</option>
            </select>
          </div>
          <div class="sessions-list" id="sessionsList">
            <p class="empty-state">Loading sessions...</p>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content" id="mainContent">
        <!-- Welcome/New Session View -->
        <section id="view-welcome" class="view active">
          <div class="welcome-content">
            <h2>ðŸ‘‹ Welcome to Remote Agent</h2>
            <p>Select a session from the sidebar or create a new one to get started.</p>
            
            <div class="quick-start">
              <h3>Quick Start</h3>
              <button class="btn btn-primary" id="quickStartBtn">
                <span class="icon">ðŸš€</span> Create New Session
              </button>
            </div>
          </div>
        </section>

        <!-- New Session Form View -->
        <section id="view-new-session" class="view">
          <div class="view-header">
            <h2>New Session</h2>
          </div>
          
          <form id="newSessionForm" class="session-form">
            <div class="form-group">
              <label for="workspace">Workspace</label>
              <div class="input-with-action">
                <select id="workspace" class="input" required>
                  <option value="">Select a workspace...</option>
                </select>
                <button type="button" class="btn btn-icon" id="addWorkspaceBtn" title="Add Workspace">âž•</button>
              </div>
            </div>

            <div class="form-group">
              <label for="prompt">Prompt</label>
              <textarea id="prompt" class="input textarea" rows="4" placeholder="What do you want to accomplish?" required></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="model">Model</label>
                <select id="model" class="input">
                  <option value="">Default</option>
                </select>
              </div>
            </div>

            <details class="advanced-options">
              <summary>Advanced Options</summary>
              
              <div class="form-section-header">Model Overrides</div>
              <div class="form-row-3">
                <div class="form-group">
                  <label for="sessionValidationModel">Validation Model</label>
                  <select id="sessionValidationModel" class="input">
                  </select>
                </div>
                <div class="form-group">
                  <label for="sessionOutputModel">Output Model</label>
                  <select id="sessionOutputModel" class="input">
                  </select>
                </div>
              </div>
              
              <div class="form-section-header">Custom Prompts</div>
              <div class="form-group">
                <label for="validationPrompt">Validation Prompt</label>
                <textarea id="validationPrompt" class="input textarea" rows="2" placeholder="How to validate the changes..."></textarea>
              </div>

              <div class="form-group">
                <label for="outputPrompt">Output/Image Prompt</label>
                <textarea id="outputPrompt" class="input textarea" rows="2" placeholder="What outputs to generate..."></textarea>
              </div>
            </details>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" id="cancelNewSession">Cancel</button>
              <button type="submit" class="btn btn-primary" id="startSessionBtn">
                <span class="btn-text">Start Session</span>
                <span class="btn-loading" hidden>Starting...</span>
              </button>
            </div>
          </form>
        </section>

        <!-- Session Detail View with Runs Sidebar -->
        <section id="view-session" class="view">
          <div class="session-layout">
            <!-- Runs Sidebar -->
            <aside class="runs-sidebar" id="runsSidebar">
              <div class="runs-sidebar-header">
                <div class="session-info">
                  <h3 id="sessionName">Session Name</h3>
                  <span class="session-workspace" id="sessionWorkspace">Workspace</span>
                </div>
                <div class="session-meta-compact">
                  <span id="sessionBranch">ðŸŒ¿ branch</span>
                  <span id="sessionRunCount">0 runs</span>
                </div>
              </div>

              <!-- New Run Button (First Item) -->
              <button class="new-run-btn" id="newRunBtn">
                <span class="icon">âž•</span>
                <span>New Run</span>
              </button>

              <!-- Runs List -->
              <div class="runs-list-container">
                <div class="runs-list" id="runsList">
                  <p class="empty-state">No runs yet</p>
                </div>
              </div>
            </aside>

            <!-- Main Run Content -->
            <div class="run-main-content" id="runMainContent">
              <!-- New Run Form View (shown when New Run clicked) -->
              <div class="run-view" id="view-new-run">
                <div class="view-header">
                  <h2>New Run</h2>
                </div>
                <form id="newRunForm" class="run-form">
                  <div class="form-group">
                    <label for="runPrompt">Prompt</label>
                    <textarea id="runPrompt" class="input textarea" rows="3" placeholder="What do you want to do next?" required></textarea>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="runModel">Model</label>
                      <select id="runModel" class="input">
                      </select>
                    </div>
                  </div>

                  <details class="advanced-options">
                    <summary>Override Prompts</summary>
                    
                    <div class="form-section-header">Model Overrides</div>
                    <div class="form-row">
                      <div class="form-group">
                        <label for="runValidationModel">Validation Model</label>
                        <select id="runValidationModel" class="input">
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="runOutputModel">Output Model</label>
                        <select id="runOutputModel" class="input">
                        </select>
                      </div>
                    </div>
                    
                    <div class="form-section-header">Prompt Overrides</div>
                    <div class="form-group">
                      <label for="runValidation">Validation Prompt</label>
                      <textarea id="runValidation" class="input textarea" rows="2" placeholder="Override validation..."></textarea>
                    </div>

                    <div class="form-group">
                      <label for="runOutput">Output Prompt</label>
                      <textarea id="runOutput" class="input textarea" rows="2" placeholder="Override output generation..."></textarea>
                    </div>
                  </details>

                  <button type="submit" class="btn btn-primary" id="startRunBtn">
                    <span class="btn-text">Start Run</span>
                    <span class="btn-loading" hidden>Running...</span>
                  </button>
                </form>
              </div>

              <!-- Run Detail View (shown when a run is selected) -->
              <div class="run-view hidden" id="view-run-detail">
                <!-- Top Nav for Run/Commits -->
                <div class="run-tabs">
                  <button class="run-tab-btn active" data-run-tab="run">Run</button>
                  <button class="run-tab-btn" data-run-tab="commits">Commits</button>
                </div>

                <!-- Run Tab Content -->
                <div class="run-tab-content" id="run-tab-run">
                  <div class="run-content" id="runContent">
                    <p class="empty-state">Loading run...</p>
                  </div>
                </div>

                <!-- Commits Tab Content -->
                <div class="run-tab-content hidden" id="run-tab-commits">
                  <div class="git-changes" id="gitChanges">
                    <p class="empty-state">Loading commits...</p>
                  </div>
                </div>
              </div>

              <!-- Empty State (no run selected) -->
              <div class="run-view" id="view-run-empty">
                <div class="empty-run-content">
                  <h3>ðŸ‘ˆ Select a run or create a new one</h3>
                  <p>Click on a run from the sidebar to view details, or click "New Run" to start.</p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Notification Permission Banner -->
    <div id="notificationBanner" class="notification-banner" hidden>
      <p>Enable notifications to get alerts when runs complete</p>
      <button id="enableNotifications" class="btn btn-small">Enable</button>
      <button id="dismissNotifications" class="btn btn-small btn-secondary">Later</button>
    </div>

    <!-- Workspace Modal -->
    <div id="workspaceModal" class="modal" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal-content modal-lg">
        <div class="modal-header">
          <h3>Add Workspace</h3>
          <button class="modal-close" id="closeWorkspaceModal">&times;</button>
        </div>
        <form id="addWorkspaceForm" class="modal-form">
          <!-- Workspace Type Selection -->
          <div class="form-group">
            <label>Workspace Type</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="workspaceType" value="existing" checked>
                <span>Existing Folder</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="workspaceType" value="new">
                <span>Create New Folder</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="workspaceType" value="clone">
                <span>Clone Repository</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="workspaceName">Name</label>
            <input type="text" id="workspaceName" class="input" placeholder="My Project" required>
          </div>
          
          <!-- Path for existing/new folder -->
          <div class="form-group" id="pathGroup">
            <label for="workspacePath">Path</label>
            <input type="text" id="workspacePath" class="input" placeholder="/home/user/projects/my-project" required>
          </div>
          
          <!-- Git URL for clone -->
          <div class="form-group" id="gitUrlGroup" hidden>
            <label for="workspaceGitUrl">Repository URL</label>
            <input type="text" id="workspaceGitUrl" class="input" placeholder="https://github.com/user/repo.git">
          </div>
          
          <!-- Target path for clone -->
          <div class="form-group" id="targetPathGroup" hidden>
            <label for="workspaceTargetPath">Target Directory (optional)</label>
            <input type="text" id="workspaceTargetPath" class="input" placeholder="Leave empty for ~/remote-agent-workspaces/">
          </div>
          
          <!-- Git init checkbox for new folder -->
          <div class="form-group" id="gitInitGroup" hidden>
            <label class="checkbox-label">
              <input type="checkbox" id="workspaceInitGit" checked>
              <span>Initialize Git repository</span>
            </label>
          </div>
          
          <div class="form-section-header">Default Models</div>
          <div class="form-row-3">
            <div class="form-group">
              <label for="wsDefaultModel">Prompt Model</label>
              <select id="wsDefaultModel" class="input">
              </select>
            </div>
            <div class="form-group">
              <label for="wsValidationModel">Validation Model</label>
              <select id="wsValidationModel" class="input">
              </select>
            </div>
            <div class="form-group">
              <label for="wsOutputModel">Output Model</label>
              <select id="wsOutputModel" class="input">
              </select>
            </div>
          </div>
          
          <div class="form-section-header">Default Prompts</div>
          <div class="form-group">
            <label for="workspaceValidation">Validation Prompt</label>
            <textarea id="workspaceValidation" class="input textarea" rows="2" placeholder="Verify changes work correctly"></textarea>
          </div>
          <div class="form-group">
            <label for="workspaceOutput">Output/Image Prompt</label>
            <textarea id="workspaceOutput" class="input textarea" rows="2" placeholder="Generate screenshots of the result"></textarea>
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancelAddWorkspace">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submitWorkspaceBtn">Add Workspace</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
  </div>

  <script src="/js/app.js" type="module"></script>
</body>
</html>
